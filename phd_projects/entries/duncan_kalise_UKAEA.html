<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr Andrew Duncan (with cosupervision from Dr Lorenzo Zanisi and Dr Helen Brooks at UKAEA)">
<meta name="dcterms.date" content="2024-11-21">

<title>Robust Multi-objective and Mutli-fidelity Bayesian Optimisation of Fusion Breeder Blankets – CCMI</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../static/assets/ccmi_rounded_colour.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-e0accf1c42d2821f88325b60c265fa40.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Robust Multi-objective and Mutli-fidelity Bayesian Optimisation of Fusion Breeder Blankets – CCMI">
<meta property="og:description" content="EPSRC Centre for Doctoral Training in Colllaborative Compuational Modelling at the Interface">
<meta property="og:site_name" content="CCMI">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../static/assets/ccmi_rounded_colour.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">CCMI</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../events/event_list.html"> 
<span class="menu-text">Events</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../training/training.html"> 
<span class="menu-text">Training Programme</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../apply.html"> 
<span class="menu-text">How to apply</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog/blog_list.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../faq.html"> 
<span class="menu-text">FAQ</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-about" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">About</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-about">    
        <li>
    <a class="dropdown-item" href="../../team.html">
 <span class="dropdown-text">Our Leadership Team</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../#contact-us">
 <span class="dropdown-text">Contact us</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Robust Multi-objective and Mutli-fidelity Bayesian Optimisation of Fusion Breeder Blankets</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Supervisor</div>
  <div class="quarto-title-meta-heading">Institution</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Dr Andrew Duncan (with cosupervision from Dr Lorenzo Zanisi and Dr Helen Brooks at UKAEA) </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Imperial
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 21, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="project-description" class="level2">
<h2 class="anchored" data-anchor-id="project-description">Project Description</h2>
<p>Within many fusion power plant concepts, breeder blankets fulfil a multi-functional role. Neutrons emitted in deuterium-tritium fusion reactions must be absorbed, in part to reduce damaging irradiation to other essential components (such as superconducting magnets) and outer structural material. The neutrons’ energy must be converted to heat; the heat must be transported by a coolant where it will be ultimately employed to drive conventional steam-based turbines for generation of electricity. Some neutrons must also participate in reactions to breed tritium to sustain fusion reactions. The tritium must be extracted at a rate that supports plant availability. Structural material must remain within safe operational conditions, while significant pressure drops in the coolant must be minimised to optimise power plant efficiency. Materials suitable for each of these functions are usually not interchangeable and thus there are necessarily trade-offs in the spatial allocation for the sub-components responsible for each function. This domain is therefore highly suitable for a multi-objective optimisation over geometric parameters.</p>
<p>Simulation of the breeder blanket must necessarily span multiple physics domains, minimally including neutronics, heat transfer and computational fluid dynamics (CFD). Depending on the level of fidelity selected for CFD - which may range from 1D correlations, reduced order turbulence models, through to direct numerical simulations - the computational cost for evaluating a single design point can vary enormously. A lack of fidelity may conceal emergent phenomenon; such effects have already been noted in reference [1] where local hotspots were observed only with higher fidelity models. Meanwhile too much fidelity may render unviable any optimisation algorithm. We propose a multi-fidelity approach, where inexpensive low-fidelity simulations inform the query to expensive high-fidelity simulations towards the global optimum.</p>
<p>Besides setting the appropriate level of fidelity, there are other considerations in ensuring robustness to the optimisation procedure. The limited tolerances in the manufacturing process imply an uncertainty in the material composition and inevitable small differences in the component shape compared to the simulated one. Furthermore, the empirical nuclide cross-section data for those materials (which are inputs to the neutron transport calculations) are often associated with significant uncertainties. As such, the optimisation procedure should select configurations that are stable under small perturbations in both parameter space and in the input nuclear data.</p>
<p>Bayesian Optimisation provides a theoretically solid foundation to perform sample-efficient maximisation of a noisy black-box function, with guaranteed convergence rates. In this project, the efficacy of Bayesian optimisation methods applied to breeder blankets will be explored.</p>
<section id="existing-background-work" class="level3">
<h3 class="anchored" data-anchor-id="existing-background-work">Existing background work</h3>
<p>Recent years have seen the development of scalable and open-source multi-physics software that is suitable for the modelling of fusion components. In particular, the MOOSE framework [2] offers a flexible platform for the solution of arbitrary partial differential equations using the finite element method, with many built-in physics modules as well as couplings to specialist tools for Monte Carlo neutron transport (OpenMC) [3,4] and spectral element computational fluid dynamics (NekRS) [5]. MOOSE applications have been used to simulate a variety of breeder blanket concept designs, including both solid ceramic and liquid lead-lithium breeders [6,7,8].</p>
<p>Parametric optimisation studies involving MOOSE for analysis have already been performed for the simple case of a divertor monoblock component [9]. While such studies are indicative of methodology, a limiting factor in pursuing a similar approach to breeder blankets until recently was the existence of a suitable tool to generate geometry. However, a blanket geometry engine, Hypnos, has recently been developed, with an initial demonstration of the software indicating that geometric optimisation is now possible [10]. With a proven tool-chain already in place for analysis, the primary area for innovation would pertain to the development and deployment of the optimisation algorithms themselves, with a particular focus on the robustness of the outcomes.</p>
<p>In decision problems arising from industrial processes, the design parameters are often subject to uncertainty. This uncertainty can stem from limited data observability, noisy measurements, implementation challenges, or prediction errors. In the context of manufacturing, this uncertainty may arise from manufacturing tolerances, and material imperfections. Stochastic Optimsation (SO) methods have classically allowed to model this uncertainty within a decision-making framework, assuming that the decision maker has complete knowledge about the underlying uncertainty through a known probability distribution. On the other hand, in robust optimisation it is assumed that the decision maker has only minimal distributional knowledge about the underlying uncertainty, and the optimiser seeks to minimise the worst-case outcome over an uncertainty set. This has been extended to the multi-objective optimisation case in several works, where one identifies a pareto front of candidate solutions which are favourable against a set of distinct objectives. Motivated by practical limitations due to manufacturing tolerances, in [11] a robust multi-objective optimisation approach known as constraint active search (CAS) is proposed, which aims to identify diverse solutions in the region of the search space that exceeds a minimum threshold on the objectives, leveraging a post-hoc sensitivity analysis process to assess the robustness of candidate points under input noise [12].</p>
<p>Approaching robust design by decoupling data collection and sensitivity analysis is central to the Taguchi method [13]. Data acquisition often revolves around finding designs that balance the mean and variance of the sensitive objective under input noise. Daulton et al [14] extended the Bayesian optimisation framework to black-box multi-objective optimisation problems, identifying a pareto front of candidate solutions with associated robustness guarantees. Integration of these approaches with large-scale simulation frameworks remains a challenge. In [14] the authors derive a new framework for batch-based black-box optimisation which enables the effective use of parallel simulations to obtain high-quality optimisation candidates. This was subsequently applied in the context of calibrating JOREK, and MHD simulator for fusion in [15]. In [16] the authors explore another optimisation-centric decision problem, namely design of experiments for optimal sensor placement, which is able to exploit multi-resolution simulation data through resolution-invariant learning methods.</p>
<p>[1] F. A. Hernández et al.&nbsp;(2019) ‘Advancements in the Helium-Cooled Pebble Bed Breeding Blanket for the EU DEMO: Holistic Design Approach and Lessons Learned’, Fusion Science and Technology, 75(5), pp.&nbsp;352–364. doi: 10.1080/15361055.2019.1607695</p>
<p>[2] C. J. Permann et al.&nbsp;(2020) ‘MOOSE: Enabling massively parallel multiphysics simulation’, SoftwareX, 11 (100430), doi: 10.1016/j.softx.2020.100430</p>
<p>[3] H. Brooks et al (2022), ‘Scalable multi-physics for fusion reactors with AURORA’, Plasma Physics and Controlled Fusion, 65 (2), 024002, doi: 10.1088/1361-6587/aca998</p>
<p>[4] A.J. Novak et al (2024), ‘Monte Carlo multiphysics simulation on adaptive unstructured mesh geometry’, Nuclear Engineering and Design, 429 (113589), doi: 10.1016/j.nucengdes.2024.113589.</p>
<p>[5] A.J. Novak et al (2022), ‘Coupled Monte Carlo and thermal-fluid modeling of high temperature gas reactors using Cardinal’, Annals of Nuclear Energy, 177 (109310), doi: 10.1016/j.anucene.2022.109310.</p>
<p>[6] H. Brooks et al (2022), ‘Towards multiphysics simulations of fusion breeder blankets’, Int. Conf. on Physics of Reactors 2022 (American Nuclear Society) pp 2480–9</p>
<p>[7] A. Novak et al (2023) ‘Multiphysics Coupling of OpenMC CAD-Based Transport to MOOSE using Cardinal and Aurora’, The International Conference on Mathematics and Computational Methods Applied to Nuclear Science and Engineering (M&amp;C 2023)</p>
<p>[8] F. Kong et al (2022), “Toward a Fully Integrated Multiphysics Simulation Framework for Fusion Blanket Design,” IEEE Transactions on Plasma Science, 50 (11) pp.&nbsp;4446-4452, Nov.&nbsp;2022, doi: 10.1109/TPS.2022.3173158</p>
<p>[9] L. R. Humphrey et al (2024), ‘Machine learning techniques for sequential learning engineering design optimisation’, Plasma Physics and Controlled Fusion, 66 (025002), DOI 10.1088/1361-6587/ad11fb</p>
<p>[10] H. Brooks et al (2024), ‘An Open-Source Digital Engineering Pipeline for Enabling In-silico Design and Qualification of Tritium Breeding Devices’, 26th Technology of Fusion Energy Meeting (TOFE 2024)</p>
<p>[11] Malkomes, Gustavo, et al.&nbsp;“Beyond the pareto efficient frontier: Constraint active search for multiobjective experimental design.” International Conference on Machine Learning. PMLR, 2021.</p>
<p>[12] Calandra, Roberto, Jan Peters, and M. P. Deisenrothy. “Pareto front modeling for sensitivity analysis in multi-objective bayesian optimization.” NIPS Workshop on Bayesian Optimization. Vol. 5. 2014.</p>
<p>[13] Taguchi, Genichi. Introduction to quality engineering: designing quality into products and processes. 1986.</p>
<p>[14] Daulton, Samuel, et al.&nbsp;“Robust multi-objective bayesian optimization under input noise.” International Conference on Machine Learning. PMLR, 2022.</p>
<p>[14] Crovini, Enrico, et al.&nbsp;“Batch Bayesian optimization via particle gradient Flows.” arXiv preprint arXiv:2209.04722 (2022).</p>
<p>[15] Crovini, E., et al.&nbsp;“Automatic JOREK calibration via batch Bayesian optimization.” Physics of Plasmas 31.6 (2024).</p>
<p>[16] Cordero-Encinar, Paula, et al.&nbsp;“Deep Optimal Sensor Placement for Black Box Stochastic Simulations.” arXiv preprint arXiv:2410.12036 (2024).</p>
<p>[17] K. Kandasamy et al.&nbsp;2016, “Multi-fidelity bayesian optimization with continuous approximations”, arXiv:1703.06240</p>
<p>[18] M. A. Gelbart et al.&nbsp;2014, “Bayesian Optimisation with unknown constraints”, arXiv:1403.5607</p>
<p>[19] R. Oliveira et al.&nbsp;2019, “Bayesian optimisation under uncertain inputs”, arXiv:1902.07908</p>
</section>
<section id="main-objectives-of-the-project" class="level3">
<h3 class="anchored" data-anchor-id="main-objectives-of-the-project">Main objectives of the project</h3>
<p>The project will initially consider the helium-cooled pebble bed (HCPB) breeder blanket. This concept is already well-established; having been considered by EU-DEMO during the preconceptual phase (2014-2020) it is being actively pursued in the conceptual design phase (2021-2027). Therefore, the design is at a suitable level of readiness for further optimisation, with high potential for impact should the methodologies prove successful. The optimisation will be performed in a multi-fidelity fashion (e.g.&nbsp;[17]), with the competing objectives of minimising pressure drop, maximising heat transfer and maximising tritium breeding ratio (TBR) subject to operational constraints (e.g.&nbsp;[18]). The result of the procedure should be robust to uncertainties arising from limitations in manufacturing as well as from nuclear data libraries, (e.g.&nbsp;[19]).</p>
</section>
<section id="details-of-softwaredata-deliverables" class="level3">
<h3 class="anchored" data-anchor-id="details-of-softwaredata-deliverables">Details of Software/Data Deliverables</h3>
<p>The student will leverage the multi-physics simulation engine for Bayesian Optimisation studies. A separate GitHub repository will be created, aimed at providing a general purpose framework for relevant black-box optimisation tasks. This will include baselines based on existing packages, for example the widely popular BoTorch package, as well as novel algorithms developed within the duration of the studies. Due to the ubiquity of this problem, we envisage that this framework will be valuable to decision makers across a wide range of sectors.</p>


</section>
</section>

</main> <!-- /main -->
<div class="column-page page-full mt-5 wave-background d-flex flex-column align-items-center justify-content-end">
	<div id="contact-us" class="pt-3 d-flex flex-column align-items-center text-center">
		<h3>Feel free to drop us a line with questions or feedback!</h3>
		<a href="mailto:arc.ccmi-cdt@ucl.ac.uk?subject=CCMI%20Question&amp;body=Hello,%20I%20saw%20your%20website%20and..." class="btn btn--contact mt-2">
			Contact Us</a>
	</div>
	<div class="footer__info w-100 text-center">
		<h5>
			CCMI is a collaboration between UCL and Imperial College, funded by
			<a href="https://www.ukri.org/councils/epsrc/">EPSRC</a>.
		</h5>
		<div id="logos" class="mt-4">
			<a href="https://www.ukri.org/who-we-are/epsrc/">
				<img src="../../static/assets/ukri_logo.png" href="https://www.ukri.org/who-we-are/epsrc/" alt="UKRI logo"></a>
			<img src="../../static/assets/ccmi_square_colour_text.png" alt="CCMI logo">

			<a href="https://www.imperial.ac.uk/">
				<svg xmlns="http://www.w3.org/2000/svg" height="19.48" viewbox="0 0 177.3 19.48">
					<polygon points="73.53 0 73.53 19.47 86.19 19.47 86.19 16.07 77.23 16.07 77.23 11.2 85.41 11.2 85.41 7.89 77.23 7.89 77.23 3.41 86.19 3.41 86.19 0 73.53 0" fill="#fff"></polygon>
					<path d="M58.15,3.14H55.42V9.71h2.73c2.13,0,3.7-1,3.7-3.28s-1.57-3.29-3.7-3.29m.19,9.71H55.42v6.62h-3.7V0h6.62c4.16,0,7.4,1.88,7.4,6.43s-3.27,6.42-7.4,6.42" fill="#fff"></path>
					<polygon points="118.32 0 118.32 3.41 122.89 3.41 122.89 16.07 118.32 16.07 118.32 19.47 131.17 19.47 131.17 16.07 126.59 16.07 126.59 3.41 131.17 3.41 131.17 0 118.32 0" fill="#fff"></polygon>
					<path d="M105.9,6c0,2.34-1.36,3.08-3.7,3.08H99.09v-6h3.11c2.54,0,3.7.94,3.7,2.89m3.9,0c0-4.55-3.12-6-7.21-6h-7.2V19.47h3.7v-7.2h3.62l3.77,7.22h4.1l-4.18-8A5.53,5.53,0,0,0,109.8,6" fill="#fff"></path>
					<path d="M147.4,3.45l2.66,8.6h-5.32ZM145,0l-6.43,19.47h3.9l1.33-4.28H151l1.33,4.28h3.89L149.84,0Z" fill="#fff"></path>
					<polygon points="164.62 0 164.62 19.47 177.3 19.47 177.3 16.07 168.31 16.07 168.31 0 164.62 0" fill="#fff"></polygon>
					<polygon points="37.05 0 32.38 11.45 27.7 0 22.45 0 22.45 19.47 25.95 19.47 25.95 4.91 30.43 15.19 30.63 15.19 34.13 15.19 34.33 15.19 38.8 4.91 38.8 19.47 42.31 19.47 42.31 0 37.05 0" fill="#fff"></polygon>
					<polygon points="0 0 0 3.41 4.58 3.41 4.58 16.07 0 16.07 0 19.47 12.85 19.47 12.85 16.07 8.28 16.07 8.28 3.41 12.85 3.41 12.85 0 0 0" fill="#fff"></polygon>
				</svg>
			</a>
			<a href="https://www.ucl.ac.uk/mathematical-physical-sciences/news/2024/mar/ucl-receives-ps54m-boost-doctoral-training-engineering-and-physical-sciences">
				<img src="../../static/assets/UCL_logo.png" alt="UCL Logo white"></a>
		</div>
	</div>
</div>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ccmi-cdt\.org");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>